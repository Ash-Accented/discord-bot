//
const { SlashCommandBuilder, EmbedBuilder } = require('discord.js')
const fs = require('fs');
const path = require('path');
const util = require('util');
const exec = util.promisify(require('child_process').exec);

async function runCommand (commandString) {
  const { stdOut, stdErr } = await exec(commandString);
  const strErrors = (!stdErr) ? 'No Errors!' : stdErr;
  const strOutput = (!stdOut) ? 'No Output!' : stdOut;
  
  interaction.channel.send({
    content: `${strOutput}`,
    embeds: [new EmbedBuilder()
      .setDescription(`**${strOutput}**`)
      .setTitle(`\n***OUTPUT:***`)
      .setAuthor({
        name: interaction.member.user.displayName,
        iconURL: interaction.member.user.displayAvatarURL(),
      })
      .addFields({ name: `***\nERRORS: ***`, value: `**${strErrors}**`, inline: true })
      .addFields({ name: `***\nCOMMAND: ***`, value: `**${commandString}**`, inline: true })
      .setColor(0xcec1e6),
    ],
  }); 

  console.log('Output:', strOutput);
  console.log('Errors:', strErrors);
  return;
}


module.exports = {
  data: new SlashCommandBuilder()
    .setName('bash_command')
    .setDescription('Run a bash command from a discord channel of choice')
    .addStringOption(option =>
      option.setName('command_string')
        .setDescription('The command of your choice')
        .setRequired(true)
    ),
  async execute(interaction){
    const commandString = interaction.options.getString('command_string');
    runCommand(commandString);
  },
    
};
